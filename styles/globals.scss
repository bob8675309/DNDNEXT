/* ====================== Base layout ====================== */
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  min-height: 100%;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  overflow-x: hidden;
}
#__next { width: 100%; min-height: 100%; }

/* Keep navbar/offcanvas above everything relevant */
.navbar { z-index: 1100; }
.offcanvas, .offcanvas-backdrop { z-index: 1080; }

/* Optional sidebar shell (if used) */
.sidebar {
  z-index: 1050;
  max-height: 100vh;
  overflow-y: auto;
  background: #f8f9fa;
  border-left: 1px solid #dee2e6;
}

/* ====================== Theme tokens ====================== */
:root {
  --page-bg:   #1a1426;  /* deep eggplant */
  --card-bg:   #231a33;  /* surface */
  --card-bg-2: #281f3a;  /* alt surface */
  --text:      #e9e4f7;
  --muted:     #b7aeda;
  --border:    #3a2c53;
  --accent:    #7e58ff;  /* lavender */
  --accent-2:  #ffb84d;  /* warm gold */

  /* Panel tokens used by LocationSideBar / merchant panel */
  --panel-bgsoft:  #241b34;
  --panel-border:  #3a2c53;
  --panel-text:    #efe9ff;
  --panel-muted:   #b7aeda;
}

body { background: var(--page-bg); color: var(--text); }

/* Navbar */
.navbar.bg-body-tertiary {
  background: var(--card-bg) !important;
  border-color: var(--border) !important;
}
.navbar .navbar-brand,
.navbar .nav-link { color: var(--text); }
.navbar .nav-link:hover { color: var(--accent); }

/* ====================== Generic UI ====================== */
.card { background: var(--card-bg); color: var(--text); border: 1px solid var(--border); }
.card-header { background: var(--card-bg-2); border-bottom: 1px solid var(--border); }

/* Inputs */
.form-control, .form-select, .input-group-text {
  background: #1f1930; color: var(--text); border-color: var(--border);
}
.form-control::placeholder { color: var(--muted); }

/* Buttons */
.btn-outline-primary { color: var(--accent); border-color: var(--accent); }
.btn-outline-primary:hover { background: var(--accent); color: #100a1a; }
.btn-primary { background: var(--accent); border-color: var(--accent); }
.btn-primary:hover { filter: brightness(1.1); }

/* Admin context */
.admin-dark { color: #e9ecef; }
.admin-dark .form-label { color: var(--muted); }
.admin-dark .form-control,
.admin-dark .form-select,
.admin-dark .input-group-text { background: #1f2430; color: #e9ecef; border-color: #2f3442; }
.admin-dark .form-control::placeholder { color: #6c757d; }
.admin-dark .card, .admin-dark .card-header { background: #1b1f2a; }
.admin-dark pre { color:#e6e6e6; }

/* Pills / badges */
.slot-pill { border-radius: 999px; border-width: 1px; backdrop-filter: blur(2px); }
.badge-soft {
  background: rgba(255,255,255,.08);
  border: 1px solid var(--border);
  border-radius: .5rem;
  padding: .1rem .45rem;
  font-weight: 600;
  color: var(--muted);
}

/* ====================== Item Card ====================== */
.sitem-card {
  background: var(--card-bg);
  color: var(--text);
  border: 0; border-radius: 1rem; box-shadow: 0 6px 18px rgba(0,0,0,.12);
  overflow: hidden; position: relative;

  .sitem-header, .sitem-footer { background: #2b2140; color: #fff; border-color: var(--accent-2); }
  .sitem-header { padding: .6rem 1rem; border-bottom: 2px solid var(--accent-2); }
  .sitem-footer { padding: .4rem 1rem; border-top: 2px solid var(--accent-2); }

  .sitem-title { font-weight: 700; letter-spacing: .3px; }
  .sitem-type  { display: inline-block; background: rgba(255,255,255,.08); padding: .15rem .5rem; border-radius: .35rem; font-weight: 600; }

  .sitem-meta { font-style: italic; color: #d3a4a4; .sitem-rarity { text-transform: lowercase; } }
  .sitem-section { background: rgba(255,255,255,.06); border: 1px dashed rgba(255,255,255,.08); border-radius: .5rem; padding: .5rem .6rem; min-height: 64px; }
  .sitem-thumb { background: #2a2339; border: 1px dashed rgba(255,255,255,.08); border-radius: .5rem; overflow: hidden; }
  .sitem-footer .sitem-type { width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
}

/* Rarity accent variables */
.rarity-common{ --rarity-color:#ced4da; } .rarity-uncommon{ --rarity-color:#78c850; }
.rarity-rare{ --rarity-color:#5aa7f3; } .rarity-very-rare{ --rarity-color:#a67cf3; }
.rarity-legendary{ --rarity-color:#f3b24d; } .rarity-artifact{ --rarity-color:#e85d5d; }

/* ====================== Map layout ====================== */
.map-page { --top-ui: 120px; }
.map-shell{ position: relative; display:flex; justify-content:center; }
.map-wrap{ position: relative; display:inline-block; max-width: min(100%, 1400px); }
.map-img{ display:block; width:auto; height:auto; max-width:100%; max-height:calc(100vh - var(--top-ui)); }
.map-overlay{ position:absolute; inset:0; pointer-events:none; }
.map-toolbar{ position: sticky; top: .5rem; z-index: 5; }

/* Dim */
.map-dim{ position:absolute; inset:0; background: radial-gradient(120% 120% at 20% 20%, rgba(0,0,0,.35), rgba(0,0,0,.65)); opacity:0; pointer-events:none; transition:opacity .18s ease; z-index:3; }
.map-dim.show{ opacity:1; }

@media (max-width: 576px) { .map-page { --top-ui: 150px; } }

/* Base pin */
.map-pin{ position:absolute; top:0; left:0; transform: translate(-50%, -100%); width:24px; height:24px; background: transparent; border:0; box-shadow:none; pointer-events:auto; }
.map-pin:hover{ outline: 2px dashed rgba(255,255,255,.18); outline-offset: -2px; }

/* Non-merchant pins tint */
.pin-location,
.map-pin:not(.pin-merchant):not(.merchant-pin):not(.merch-pin){ background: rgba(126,88,255,.30); border: 2px solid #bfa3ff; }
.map-pin:not(.pin-merchant):hover{ background: rgba(126,88,255,.5); }

/* Merchant diamond symbol */
.merchant-pin, .merch-pin, .pin-merchant .merchant-icon{
  position:relative; display:block; width:22px; height:22px; border-radius:.35rem;
  background:#ff9f1c; border:2px solid #fff; box-shadow:0 2px 10px rgba(0,0,0,.45);
  transform: rotate(45deg);
}
.pin-merchant:hover .merchant-icon{ transform: rotate(45deg) translateY(-2px) scale(1.05); }

/* === Icon-only merchants; reveal label on hover/focus === */
.pin-label{
  position:absolute; left:50%; top:0; transform: translate(-50%, -130%);
  white-space:nowrap; padding:.2rem .5rem; border-radius:.4rem; font-weight:700; font-size:.9rem;
  color:#fff; background: rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.25);
  box-shadow:0 6px 16px rgba(0,0,0,.35); display:none; pointer-events:none; z-index:4;
}
.pin-merchant .pin-label{ display:none; }
.pin-merchant:hover .pin-label, .pin-merchant:focus .pin-label{ display:inline-block; }

/* ensure no inline names show up */
.map-pin .pin-name{ display:none !important; }

/* Theme pills (if used in lists) */
.pill{ display:inline-flex; align-items:center; gap:.35rem; padding:.15rem .5rem; border-radius:999px; font-weight:600; backdrop-filter:blur(2px); border:1px solid rgba(255,255,255,.25); background:rgba(0,0,0,.35); color:#fff; }
.pill-sm{ font-size:.85rem; }

/* === Pill-style merchant pins (icon-only) === */
.pin-pill {
  /* pill container on the map */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: .25rem;
  padding: .15rem .4rem;
  border-radius: 999px;
  font-weight: 700;
  line-height: 1;
  border: 1px solid rgba(255,255,255,.25);
  background: rgba(0,0,0,.35);
  color: #fff;
  cursor: pointer;
  pointer-events: auto;
}
.pin-pill .pill-ico { font-size: 14px; line-height: 1; }

/* Name bubble shown on hover/focus (shared with diamond pins) */
.pin-merchant .pin-label{ display:none; }
.pin-merchant:hover .pin-label,
.pin-merchant:focus .pin-label{ display:inline-block; }

/* Theme tints for pill pins (matches your earlier palette) */
.pill-alchemist, .pill-apothecary { background: rgba(43,212,197,.25); border-color: rgba(43,212,197,.45); }
.pill-smith, .pill-armorer        { background: rgba(255,184,77,.25); border-color: rgba(255,184,77,.45); }
.pill-fletcher                    { background: rgba(83,160,255,.25);  border-color: rgba(83,160,255,.45); }
.pill-arcane, .pill-occult        { background: rgba(166,124,243,.25); border-color: rgba(166,124,243,.45); }
.pill-dwarven                     { background: rgba(185,185,195,.25); border-color: rgba(185,185,195,.45); }
.pill-drow                        { background: rgba(155,108,255,.25); border-color: rgba(155,108,255,.45); }
.pill-kaorti                      { background: rgba(232,93,93,.25);   border-color: rgba(232,93,93,.45); }
.pill-general                     { background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.25); }


/* ====================== Map Sidebar (readable) ====================== */
.loc-panel .offcanvas-body{ color:var(--panel-text); line-height:1.6; max-height:calc(100vh - 56px); overflow-y:auto; overflow-x:visible; padding-right:.5rem; }
.loc-panel .btn-close{ filter: invert(1) brightness(1.3); opacity:.9; }
.loc-panel .offcanvas-header{ border-bottom:1px solid var(--panel-border); }
.loc-panel .offcanvas-title{ color:var(--panel-text); font-size:1.35rem; font-weight:700; letter-spacing:.3px; }
.loc-panel .loc-desc{ color:var(--panel-muted); }
.loc-panel .loc-sec{ background:var(--panel-bgsoft); border:1px solid var(--panel-border); border-radius:12px; padding:.85rem; margin-bottom:1rem; }
.loc-panel .loc-sec-title{ display:flex; align-items:center; justify-content:space-between; font-weight:700; letter-spacing:.2px; margin-bottom:.5rem; color:var(--panel-text); }
.loc-panel .badge-soft{ background:rgba(126,88,255,.2); border:1px solid rgba(126,88,255,.35); color:#e9e4ff; padding:.15rem .5rem; border-radius:.4rem; }
.loc-panel .loc-item + .loc-item{ margin-top:.6rem; }
.loc-panel .text-muted{ color:var(--panel-muted) !important; }

/* Merchant panel & cards should float above the map */
#merchantPanel { z-index: 2200; } /* above navbar/offcanvas defaults */
.merchant-grid .tile:hover .sitem-card,
.merchant-grid .tile:focus-within .sitem-card { z-index: 3000; }

/* The dim on the map is purely visual; clicks pass through. We also set inline pointer-events:none for safety. */
.map-dim { pointer-events: none; }

/* Be extra-safe that the map itself never eclipses the offcanvas */
.map-shell, .map-wrap, .map-overlay { z-index: 0; }


/* ===== Mini-card grid (merchant view) ===== */
:root{ --card-w:360px; --card-h:520px; --mini-scale:.25; }
#merchantPanel .offcanvas-body{
  overflow-y:auto; max-height:calc(100vh - 96px); padding-right:10px; scrollbar-gutter:stable both-edges;
  background:#f6f1e5 url('/parchment.jpg') center/cover fixed;
}
#merchantPanel .offcanvas-header{ background:rgba(0,0,0,.08); border-bottom:1px solid rgba(0,0,0,.12); }
.merchant-grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:14px; align-items:start; padding-bottom:24px; }
.merchant-grid .tile{ position:relative; width:calc(var(--card-w)*var(--mini-scale)); height:calc(var(--card-h)*var(--mini-scale) + 36px); outline:none; overflow:visible; }
.merchant-grid .tile .sitem-card{
  position:absolute; right:0; top:0; width:var(--card-w); height:var(--card-h);
  transform-origin:top right; transform:scale(var(--mini-scale));
  transition:transform .15s ease, box-shadow .15s ease, z-index .15s ease; z-index:1;
}
.merchant-grid .tile .buy-strip{
  position:absolute; left:0; right:0; bottom:0; height:32px; display:flex; align-items:center; justify-content:space-between;
  gap:8px; padding:0 .5rem; z-index:2;
}
.merchant-grid .tile:hover .sitem-card, .merchant-grid .tile:focus-within .sitem-card{ transform:scale(1); box-shadow:0 10px 28px rgba(0,0,0,.45); z-index:10; }
.merchant-grid .tile:hover .buy-strip, .merchant-grid .tile:focus-within .buy-strip{ transform:translateY(-6px); }
.merchant-grid .tile:hover, .merchant-grid .tile:focus-within{ z-index:20; }
.sitem-card{ min-width:var(--card-w); }
@media (max-width:576px){
  .merchant-grid{ grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:10px; }
  #merchantPanel .offcanvas-body{ max-height:calc(100vh - 82px); }
}
