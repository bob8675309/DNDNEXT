/* ====================== Base layout ====================== */
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  min-height: 100%;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  overflow-x: hidden;
}
#__next { width: 100%; min-height: 100%; }

/* Keep navbar/offcanvas above everything relevant */
.navbar { z-index: 1100; }
.offcanvas, .offcanvas-backdrop { z-index: 1080; }

/* Optional sidebar shell (if used) */
.sidebar {
  z-index: 1050;
  max-height: 100vh;
  overflow-y: auto;
  background: #f8f9fa;
  border-left: 1px solid #dee2e6;
}

/* ====================== Theme tokens ====================== */
:root {
  --page-bg:   #1a1426;  /* deep eggplant */
  --card-bg:   #231a33;  /* surface */
  --card-bg-2: #281f3a;  /* alt surface */
  --text:      #e9e4f7;
  --muted:     #b7aeda;
  --border:    #3a2c53;
  --accent:    #7e58ff;  /* lavender */
  --accent-2:  #ffb84d;  /* warm gold */

  /* Panel tokens used by LocationSideBar / merchant panel */
  --panel-bgsoft:  #241b34;
  --panel-border:  #3a2c53;
  --panel-text:    #efe9ff;
  --panel-muted:   #b7aeda;

  /* Card sizing tokens used by mini grid */
  --card-w: 360px;   /* natural ItemCard width */
  --card-h: 520px;   /* natural ItemCard height */

  --mini-scale: 0.25; /* 25% mini size (can be tweaked below in overrides) */

  --mini-scale: 0.24;  


}

body { background: var(--page-bg); color: var(--text); }

/* Navbar */
.navbar.bg-body-tertiary {
  background: var(--card-bg) !important;
  border-color: var(--border) !important;
}
.navbar .navbar-brand,
.navbar .nav-link { color: var(--text); }
.navbar .nav-link:hover { color: var(--accent); }

/* ====================== Generic UI ====================== */
.card { background: var(--card-bg); color: var(--text); border: 1px solid var(--border); }
.card-header { background: var(--card-bg-2); border-bottom: 1px solid var(--border); }

/* Inputs */
.form-control, .form-select, .input-group-text {
  background: #1f1930; color: var(--text); border-color: var(--border);
}
.form-control::placeholder { color: var(--muted); }

/* Buttons */
.btn-outline-primary { color: var(--accent); border-color: var(--accent); }
.btn-outline-primary:hover { background: var(--accent); color: #100a1a; }
.btn-primary { background: var(--accent); border-color: var(--accent); }
.btn-primary:hover { filter: brightness(1.1); }

/* Admin context */
.admin-dark { color: #e9ecef; }
.admin-dark .form-label { color: var(--muted); }
.admin-dark .form-control,
.admin-dark .form-select,
.admin-dark .input-group-text { background: #1f2430; color: #e9ecef; border-color: #2f3442; }
.admin-dark .form-control::placeholder { color: #6c757d; }
.admin-dark .card, .admin-dark .card-header { background: #1b1f2a; }
.admin-dark pre { color:#e6e6e6; }

/* Pills / badges */
.slot-pill { border-radius: 999px; border-width: 1px; backdrop-filter: blur(2px); }
.badge-soft {
  background: rgba(255,255,255,.08);
  border: 1px solid var(--border);
  border-radius: .5rem;
  padding: .1rem .45rem;
  font-weight: 600;
  color: var(--muted);
}

/* ====================== Item Card ====================== */
.sitem-card {
  background: var(--card-bg);
  color: var(--text);
  border: 0; border-radius: 1rem; box-shadow: 0 6px 18px rgba(0,0,0,.12);
  overflow: hidden; position: relative;

  .sitem-header, .sitem-footer { background: #2b2140; color: #fff; border-color: var(--accent-2); }
  .sitem-header { padding: .6rem 1rem; border-bottom: 2px solid var(--accent-2); }
  .sitem-footer { padding: .4rem 1rem; border-top: 2px solid var(--accent-2); }

  .sitem-title { font-weight: 700; letter-spacing: .3px; }
  .sitem-type  { display: inline-block; background: rgba(255,255,255,.08); padding: .15rem .5rem; border-radius: .35rem; font-weight: 600; }

  .sitem-meta { font-style: italic; color: #d3a4a4; .sitem-rarity { text-transform: lowercase; } }
  .sitem-section { background: rgba(255,255,255,.06); border: 1px dashed rgba(255,255,255,.08); border-radius: .5rem; padding: .5rem .6rem; min-height: 64px; }
  .sitem-thumb { background: #2a2339; border: 1px dashed rgba(255,255,255,.08); border-radius: .5rem; overflow: hidden; }
  .sitem-footer .sitem-type { width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
}

/* Rarity accent variables */
.rarity-common{ --rarity-color:#ced4da; } .rarity-uncommon{ --rarity-color:#78c850; }
.rarity-rare{ --rarity-color:#5aa7f3; } .rarity-very-rare{ --rarity-color:#a67cf3; }
.rarity-legendary{ --rarity-color:#f3b24d; } .rarity-artifact{ --rarity-color:#e85d5d; }

/* ====================== Map layout ====================== */
.map-page { --top-ui: 120px; }
.map-shell{ position: relative; display:flex; justify-content:center; }
.map-wrap{ position: relative; display:inline-block; max-width: min(100%, 1400px); }
.map-img{ display:block; width:auto; height:auto; max-width:100%; max-height:calc(100vh - var(--top-ui)); }
.map-overlay{ position:absolute; inset:0; pointer-events:none; }
.map-toolbar{ position: sticky; top: .5rem; z-index: 5; }

/* Dim */
.map-dim{ position:absolute; inset:0; background: radial-gradient(120% 120% at 20% 20%, rgba(0,0,0,.35), rgba(0,0,0,.65)); opacity:0; pointer-events:none; transition:opacity .18s ease; z-index:3; }
.map-dim.show{ opacity:1; }

@media (max-width: 576px) { .map-page { --top-ui: 150px; } }

/* Base pin */
.map-pin{ position:absolute; top:0; left:0; transform: translate(-50%, -100%); width:24px; height:24px; background: transparent; border:0; box-shadow:none; pointer-events:auto; }
.map-pin:hover{ outline: 2px dashed rgba(255,255,255,.45); outline-offset: -2px; }

/* Merchants glide between DB positions instead of teleporting */
.map-pin.pin-merchant {
  transition: top 60s linear, left 60s linear;
  transform: 0.2s ease-out;
}

/* Non-merchant pins tint */
.pin-location,
.map-pin:not(.pin-merchant):not(.merchant-pin):not(.merch-pin){ background: rgba(0,0,0,0); border: 2px solid #bfa3ff; }
.map-pin:not(.pin-merchant):hover{ background: rgba(126,88,255,.5); }

/* Merchant diamond symbol */
.merchant-pin, .merch-pin, .pin-merchant .merchant-icon{
  position:relative; display:block; width:22px; height:22px; border-radius:.35rem;
  background:#ff9f1c; border:2px solid #fff; box-shadow:0 2px 10px rgba(0,0,0,0);
  transform: rotate(45deg);
}
.pin-merchant:hover .merchant-icon{ transform: rotate(45deg) translateY(-2px) scale(1.05); }

/* === Icon-only merchants; reveal label on hover/focus === */
.pin-label{
  position:absolute; left:50%; top:0; transform: translate(-50%, -130%);
  white-space:nowrap; padding:.2rem .5rem; border-radius:.4rem; font-weight:700; font-size:.9rem;
  color:#fff; background: rgba(0,0,0,0); border:1px solid rgba(255,255,255,.25);
  box-shadow:0 6px 16px rgba(0,0,0,0); display:none; pointer-events:none; z-index:4;
}
.pin-merchant .pin-label{ display:none; }
.pin-merchant:hover .pin-label, .pin-merchant:focus .pin-label{ display:inline-block; }

/* ensure no inline names show up */
.map-pin .pin-name{ display:none !important; }

/* Theme pills (if used in lists) */
.pill{ display:inline-flex; align-items:center; gap:.35rem; padding:.15rem .5rem; border-radius:999px; font-weight:600; backdrop-filter:blur(2px); border:1px solid rgba(255,255,255,.25); background:rgba(0,0,0,.35); color:#fff; }
.pill-sm{ font-size:.85rem; }

/* === Pill-style merchant pins (icon-only) === */
.pin-pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: .25rem;
  padding: .15rem .4rem;
  border-radius: 999px;
  font-weight: 700;
  line-height: 1;
  border: 1px solid rgba(255,255,255,.25);
  background: rgba(0,0,0,0);
  color: #fff;
  cursor: pointer;
  pointer-events: auto;
}
.pin-pill .pill-ico { font-size: 14px; line-height: 1; }

/* Name bubble shown on hover/focus (shared with diamond pins) */
.pin-merchant .pin-label{ display:none; }
.pin-merchant:hover .pin-label,
.pin-merchant:focus .pin-label{ display:inline-block; }

/* Theme tints for pill pins */
.pill-alchemist, .pill-apothecary { background: rgba(43,212,197,0); border-color: rgba(43,212,197,0); }
.pill-smith, .pill-armorer        { background: rgba(255,184,77,0); border-color: rgba(255,184,77,0); }
.pill-fletcher                    { background: rgba(83,160,255,0);  border-color: rgba(83,160,255,0); }
.pill-arcane, .pill-occult        { background: rgba(166,124,243,0); border-color: rgba(166,124,243,0); }
.pill-dwarven                     { background: rgba(185,185,195,0); border-color: rgba(185,185,195,0); }
.pill-drow                        { background: rgba(155,108,255,0); border-color: rgba(155,108,255,0); }
.pill-kaorti                      { background: rgba(232,93,93,0);   border-color: rgba(232,93,93,0); }
.pill-general                     { background: rgba(255,255,255,0); border-color: rgba(255,255,255,0); }

/* Route overlay lines drawn from map_route_points */
.route-overlay {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none; /* keep clicks on map/pins */
  overflow: visible;
}

.route-path {
  fill: none;
  stroke: rgba(0, 255, 255, 0.5);
  stroke-width: 0.6; /* viewBox units (0–100) */
  stroke-linecap: round;
  stroke-linejoin: round;
}

.route-path.route-type-trade {
  stroke: rgba(0, 255, 255, 0.7);
}

.route-path.route-type-excursion {
  stroke: rgba(255, 165, 0, 0.7);
}


/* ====================== Map Sidebar (readable) ====================== */
.loc-panel .offcanvas-body{ color:var(--panel-text); line-height:1.6; max-height:calc(100vh - 56px); overflow-y:auto; overflow-x:visible; padding-right:.5rem; }
.loc-panel .btn-close{ filter: invert(1) brightness(1.3); opacity:.9; }
.loc-panel .offcanvas-header{ border-bottom:1px solid var(--panel-border); }
.loc-panel .offcanvas-title{ color:var(--panel-text); font-size:1.35rem; font-weight:700; letter-spacing:.3px; }
.loc-panel .loc-desc{ color:var(--panel-muted); }
.loc-panel .loc-sec{ background:var(--panel-bgsoft); border:1px solid var(--panel-border); border-radius:12px; padding:.85rem; margin-bottom:1rem; }
.loc-panel .loc-sec-title{ display:flex; align-items:center; justify-content:space-between; font-weight:700; letter-spacing:.2px; margin-bottom:.5rem; color:var(--panel-text); }
.loc-panel .badge-soft{ background:rgba(126,88,255,.2); border:1px solid rgba(126,88,255,.35); color:#e9e4ff; padding:.15rem .5rem; border-radius:.4rem; }
.loc-panel .loc-item + .loc-item{ margin-top:.6rem; }
.loc-panel .text-muted{ color:var(--panel-muted) !important; }

/* ====================== Merchant panel & map overlays ====================== */

/* Dim overlay is visual-only, never intercepts clicks and sits under panels */
.map-dim{
  position:absolute;
  inset:0;
  background: radial-gradient(120% 120% at 20% 20%, rgba(0,0,0,.35), rgba(0,0,0,.65));
  opacity:0;
  pointer-events:none;
  transition:opacity .18s ease;
  z-index:1500;
}
.map-dim.show{ opacity:1; }

/* Map itself always under side panels & merchant overlay */
.map-shell,
.map-wrap,
.map-overlay { z-index:1; }

/* Stacking for location sidebars and merchant offcanvas */
.loc-panel{ z-index:2400 !important; }
#merchantPanel.loc-panel{ z-index:2450 !important; }
#merchantPanel{ z-index:2200; }
#merchantPanel.offcanvas{ background:transparent; }


/* Map/location offcanvas sizing */
.offcanvas.loc-panel{
  width:75vw;
  max-width:1200px;
}
.offcanvas.loc-panel 
.offcanvas-body{ overflow:auto; }

/* Location sidebar look */
#locPanel .offcanvas-body{
  color:var(--panel-text);
  line-height:1.6;
  max-height:calc(100vh - 56px);
  overflow-y:auto;
  overflow-x:visible;
  padding-right:.5rem;

  background: rgba(8,10,16,.85);
  backdrop-filter: saturate(120%) blur(2px);
}
#locPanel .offcanvas-body .offcanvas-header{
  border-bottom:1px solid rgba(255,255,255,.06);
  margin:-1rem -1rem 1rem;
  padding:1rem;
}

/* Ruler overlay on the world map */
.map-ruler-overlay {
  position: absolute;
  inset: 0;
  pointer-events: none;
  width: 100%;
  height: 100%;
}

/* line + points drawn in SVG percent space */
.map-ruler-line {
  stroke: #00e6ff;
  stroke-width: 0.4;
  stroke-dasharray: 2 1;
  opacity: 0.9;
}

.map-ruler-start,
.map-ruler-end {
  fill: #00e6ff;
  stroke: #00141a;
  stroke-width: 0.2;
}

.map-ruler-end {
  fill: #ffca28;
}


/* ============================================================
   Merchant panel – map offcanvas (#merchantPanel)
   Canonical layout & mini-card grid
   ============================================================ */

#merchantPanel {
  /* Geometry for minis */
  --card-w: 360px;
  --card-h: 520px;
  --mini-scale: 0.24;
}

#merchantPanel .offcanvas-body {
  /* Panel fills the viewport under the navbar, but scrolls if taller */
  min-height: calc(100vh - 56px);
  max-height: calc(100vh - 56px);
  overflow-y: auto;
  overflow-x: visible;
  padding-right: 10px;
  background-color: #0b0911;
}

/* Root container returned by <MerchantPanel /> */
#merchantPanel .merchant-panel-inner {
  position: relative;
  display: flex;
  flex-direction: column;
  height: 100%;
  padding: 0 1rem 1.5rem;
}

/* Purple gradient header bar at the top */
#merchantPanel .merchant-panel-header {
  flex: 0 0 auto;
  position: relative;
  z-index: 3;
  padding: .75rem 1rem;
  margin: .75rem 0 .75rem;
  border-radius: 1rem;
  background: linear-gradient(90deg, #221733, #3e285f);
  box-shadow: 0 6px 22px rgba(0,0,0,.55);
}

/* Body with dwarf art + card area on the right */
#merchantPanel .merchant-panel-body {
  position: relative;
  flex: 1 1 auto;
  padding: 1rem;
  border-radius: 1rem;
  overflow: visible;

  display: flex;
  justify-content: flex-end;
  align-items: flex-start;

  z-index: 10; /* foreground container: above video (-2) & gradient (-1) */

  /* full 736x736 art, slightly “scrunched” left */
  background-image: var(--merchant-bg, url("/images/merchants/default.jpg"));
  background-size: contain;
  background-position: center left;
  background-repeat: no-repeat;
}

/* Darker, more transparent gradient behind the cards, right → left */
#merchantPanel .merchant-panel-body::after {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;

  /* about half the previous bar, more subtle */
  width: 25%;

  background: linear-gradient(
    to left,
    rgba(5, 2, 12, 0.7),
    rgba(30, 12, 60, 0.35),
    transparent 80%
  );

  pointer-events: none;
  z-index: -1; /* sits over the art, under the cards */
}

/* Slide-out Travel & Routes panel inside MerchantPanel */
.merchant-travel-panel {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  width: 360px;            // adjust width to taste
  transform: translateX(-100%);
  transition: transform 0.25s ease-out;
  pointer-events: none;    // don't block clicks when hidden
  z-index: 30;            // above .merchant-grid (z-index: 20)
}

.merchant-travel-panel-open {
  transform: translateX(0);
  pointer-events: auto;
}

.merchant-travel-panel .merchant-travel-admin {
  height: 100%;
  overflow-y: auto;
}



/* ====================== Mini-card grid ====================== */

/* Tight 3-column cluster hugging the right edge */
#merchantPanel .merchant-grid {
  position: relative;
    flex: 1 1 40%;
  height: 100%;
  overflow-y: auto;
  padding-right: 0.5rem;
  z-index: 20; /* above gradient, under expanded cards */
  display: grid;

  /* exactly 3 columns; rows fill tightly top-to-bottom */
  grid-template-columns: repeat(3, calc(var(--card-w) * var(--mini-scale)));
  grid-auto-rows: auto;
  grid-auto-flow: row dense;

  /* zero out unnecessary margins */
  margin: 0;
  padding: 0 0 20px 0;

  /* tighten vertical and horizontal spacing */
  gap: 4px 6px;

  /* push cluster all the way to the right side of the art */
  justify-content: end;
  align-content: start;
  align-items: start;
  width: auto;

  /* prevents any extra centering */
  margin-left: auto;
}


/* Each tile is the hit-area for one mini-card */
#merchantPanel .merchant-grid .tile {
  position: relative;
  width: calc(var(--card-w) * var(--mini-scale));
  height: calc(var(--card-h) * var(--mini-scale) + 36px); /* room for buy strip */
  outline: none;
  overflow: visible;
  z-index: 1;
}

/* Full-size card scaled down into a mini */
#merchantPanel .merchant-grid .tile .sitem-card {
  position: absolute;
  right: 0;
  top: 0;
  width: var(--card-w);
  height: var(--card-h);
  transform-origin: top right;
  transform: scale(var(--mini-scale));
  transition: transform .15s ease, box-shadow .15s ease, z-index .15s ease;
  z-index: 1;

  /* Minis stay clean: no scrollbars */
  overflow: hidden;
}


/* Buy strip pinned to the bottom, hidden until active */
#merchantPanel .merchant-grid .tile .buy-strip {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 32px;

  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 0 .5rem;

  /* Make sure this sits above the card */
  z-index: 14000;
  opacity: 0;
  pointer-events: none;
  transition: opacity .12s ease, transform .12s ease;
}

/* Hover/focus: lift tile so neighbors don’t occlude it */
#merchantPanel .merchant-grid .tile:hover,
#merchantPanel .merchant-grid .tile:focus-within {
  z-index: 50;
}

/* Expanded full-size card when active */
#merchantPanel .merchant-grid .tile:hover .sitem-card,
#merchantPanel .merchant-grid .tile:focus-within .sitem-card {
  transform: scale(1);
  box-shadow: 0 10px 28px rgba(0,0,0,.45);
  z-index: 13000;              /* above map, header, neighbors */

  /* Expanded card can scroll its contents */
  overflow: auto;
}


/* Reveal the buy strip on active tile */
#merchantPanel .merchant-grid .tile:hover .buy-strip,
#merchantPanel .merchant-grid .tile:focus-within .buy-strip {
  opacity: 1;
  pointer-events: auto;
  transform: translateY(-6px);
}

/* Guard so minis never collapse too small (scoped to this panel only) */
#merchantPanel .sitem-card {
  min-width: var(--card-w);
}

/* Make the whole offcanvas fill height and prevent double scroll */
.offcanvas-body > .merchant-panel-inner {
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* Header stays fixed height; body flexes */
.merchant-panel-body {
  position: relative;
  flex: 1 1 auto;
  display: flex;
  gap: 1.5rem;
  padding: 0.75rem 1.25rem 1.25rem;
  overflow: hidden; // no overall scroll, just the grid scrolls
}

/* Video column – keep it in a neat rectangle */
#merchantPanel .merchant-bg-video-wrap {
  position: absolute;
  inset: 0;              /* fill the merchant-panel-body */
  border-radius: 16px;   /* matches panel rounding */
  overflow: hidden;

  /* Always *behind* everything else in the panel */
  z-index: -2;
  pointer-events: none;  /* never steal clicks/hover */
}


/* Fit the entire 9:16 video into the available height */
.merchant-bg-video {
  width: 100%;
  height: 100%;
  object-fit: contain; // or "cover" if you prefer cropping over letterboxing
  display: block;
  
/* Don’t steal hover/click when cards overlap */
  pointer-events: none;
  
}
/* ====================== Mobile tweaks ====================== */

@media (max-width: 576px) {
  #merchantPanel .offcanvas-body {
    min-height: calc(100vh - 82px);
  }

  #merchantPanel .merchant-panel-body {
    justify-content: center;
  }

  #merchantPanel .merchant-grid {
    margin-left: 0;
    justify-content: center;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 10px;
  }
} 