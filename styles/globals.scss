/* ====================== Base layout ====================== */
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  min-height: 100%;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  overflow-x: hidden;
}
#__next { width: 100%; min-height: 100%; }

/* Keep navbar/offcanvas above everything relevant */
.navbar { z-index: 1100; }
.offcanvas, .offcanvas-backdrop { z-index: 1080; }

/* Optional sidebar shell (if used) */
.sidebar {
  z-index: 1050;
  max-height: 100vh;
  overflow-y: auto;
  background: #f8f9fa;
  border-left: 1px solid #dee2e6;
}

/* ====================== Theme tokens ====================== */
:root {
  --page-bg:   #1a1426;  /* deep eggplant */
  --card-bg:   #231a33;  /* surface */
  --card-bg-2: #281f3a;  /* alt surface */
  --text:      #e9e4f7;
  --muted:     #b7aeda;
  --border:    #3a2c53;
  --accent:    #7e58ff;  /* lavender */
  --accent-2:  #ffb84d;  /* warm gold */
}

body { background: var(--page-bg); color: var(--text); }

/* Navbar */
.navbar.bg-body-tertiary {
  background: var(--card-bg) !important;
  border-color: var(--border) !important;
}
.navbar .navbar-brand,
.navbar .nav-link { color: var(--text); }
.navbar .nav-link:hover { color: var(--accent); }

/* ====================== Generic UI ====================== */
.card {
  background: var(--card-bg);
  color: var(--text);
  border: 1px solid var(--border);
}
.card-header {
  background: var(--card-bg-2);
  border-bottom: 1px solid var(--border);
}

/* Inputs */
.form-control,
.form-select,
.input-group-text {
  background: #1f1930;
  color: var(--text);
  border-color: var(--border);
}
.form-control::placeholder { color: var(--muted); }

/* Buttons */
.btn-outline-primary { color: var(--accent); border-color: var(--accent); }
.btn-outline-primary:hover { background: var(--accent); color: #100a1a; }
.btn-primary { background: var(--accent); border-color: var(--accent); }
.btn-primary:hover { filter: brightness(1.1); }

/* Admin context */
.admin-dark { color: #e9ecef; }
.admin-dark .form-label { color: var(--muted); }
.admin-dark .form-control,
.admin-dark .form-select,
.admin-dark .input-group-text {
  background: #1f2430;
  color: #e9ecef;
  border-color: #2f3442;
}
.admin-dark .form-control::placeholder { color: #6c757d; }
.admin-dark .card,
.admin-dark .card-header { background: #1b1f2a; }
.admin-dark pre { color:#e6e6e6; }

/* Pills / badges */
.slot-pill { border-radius: 999px; border-width: 1px; backdrop-filter: blur(2px); }
.badge-soft {
  background: rgba(255,255,255,.08);
  border: 1px solid var(--border);
  border-radius: .5rem;
  padding: .1rem .45rem;
  font-weight: 600;
  color: var(--muted);
}

/* ====================== Item Card ====================== */
.sitem-card {
  background: var(--card-bg);
  color: var(--text);
  border: 0;
  border-radius: 1rem;
  box-shadow: 0 6px 18px rgba(0,0,0,.12);
  overflow: hidden;
  position: relative;

  .sitem-header,
  .sitem-footer {
    background: #2b2140;
    color: #fff;
    border-color: var(--accent-2);
  }

  .sitem-header { padding: .6rem 1rem; border-bottom: 2px solid var(--accent-2); }
  .sitem-footer { padding: .4rem 1rem; border-top: 2px solid var(--accent-2); }

  .sitem-title { font-weight: 700; letter-spacing: .3px; }
  .sitem-type  { display: inline-block; background: rgba(255,255,255,.08); padding: .15rem .5rem; border-radius: .35rem; font-weight: 600; }

  .sitem-meta {
    font-style: italic;
    color: #d3a4a4;
    .sitem-rarity { text-transform: lowercase; }
  }

  .sitem-section {
    background: rgba(255,255,255,.06);
    border: 1px dashed rgba(255,255,255,.08);
    border-radius: .5rem;
    padding: .5rem .6rem;
    min-height: 64px;
  }

  .sitem-thumb {
    background: #2a2339;
    border: 1px dashed rgba(255,255,255,.08);
    border-radius: .5rem;
    overflow: hidden;
  }

  .sitem-footer .sitem-type {
    width: 100%;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
}

/* Rarity accent variables (use on containers as needed) */
.rarity-common     { --rarity-color: #ced4da; }
.rarity-uncommon   { --rarity-color: #78c850; }
.rarity-rare       { --rarity-color: #5aa7f3; }
.rarity-very-rare  { --rarity-color: #a67cf3; }
.rarity-legendary  { --rarity-color: #f3b24d; }
.rarity-artifact   { --rarity-color: #e85d5d; }

/* ====================== Map layout ====================== */
.map-page { --top-ui: 120px; } /* reserve space for header UI */

.map-shell { position: relative; display:flex; justify-content:center; }
.map-wrap  { position: relative; display:inline-block; max-width: min(100%, 1400px); }
.map-img   { display:block; width:auto; height:auto; max-width:100%; max-height:calc(100vh - var(--top-ui)); }
.map-overlay { position:absolute; inset:0; pointer-events:none; }
.map-toolbar { position: sticky; top: .5rem; z-index: 5; }

/* Single, consistent map dim */
.map-dim {
  position:absolute; inset:0;
  background: radial-gradient(120% 120% at 20% 20%, rgba(0,0,0,.35), rgba(0,0,0,.65));
  opacity:0; pointer-events:none; transition:opacity .18s ease; z-index:3;
}
.map-dim.show { opacity:1; }

@media (max-width: 576px) { .map-page { --top-ui: 150px; } }

/* Location pin baseline (transparent by default; you can add your own tints) */
.map-pin {
  position:absolute; top:0; left:0;
  transform: translate(-50%, -100%);
  width: 24px; height: 24px;
  background: transparent;
  border: 0;
  box-shadow: none;
  pointer-events: auto;
}
.map-pin:hover { outline: 2px dashed rgba(255,255,255,.18); outline-offset: -2px; }

/* Optional tinted locations (non-merchant) */
.pin-location,
.map-pin:not(.pin-merchant):not(.merchant-pin):not(.merch-pin) {
  background: rgba(126,88,255,.30);
  border: 2px solid #bfa3ff;
}
.map-pin:not(.pin-merchant):hover { background: rgba(126,88,255,.5); }

/* Merchant “diamond” style (kept for compatibility) */
.merchant-pin, .merch-pin {
  position:absolute; left:0; top:0;
  transform: translate(-50%, -100%) rotate(45deg);
  width:22px; height:22px; border-radius:.35rem;
  background:#ff9f1c; border:2px solid #fff;
  box-shadow:0 2px 10px rgba(0,0,0,.45);
  cursor:pointer; pointer-events:auto; z-index:3;
}
.merchant-pin:hover, .merch-pin:hover {
  transform: translate(-50%, -108%) rotate(45deg) scale(1.05);
}

/* Tiny masked merchant icons (pin-merchant), with color tints */
.pin-merchant { width:16px; height:16px; border:0; background-color:#ffb84d; filter:drop-shadow(0 1px 2px rgba(0,0,0,.65)); transform:translate(-50%, -100%); background-repeat:no-repeat; background-size:contain; }
.tint-amber { background-color: #ffb84d; }
.tint-teal  { background-color: #2bd4c5; }
.tint-violet{ background-color: #9b6cff; }
.tint-blue  { background-color: #53a0ff; }
.tint-red   { background-color: #ff6a6a; }
.tint-green { background-color: #59c06b; }
.tint-gray  { background-color: #b9b9c3; }

/* ====================== Map Sidebar ====================== */
.loc-panel {
  --panel-text: #f2efff;
  --panel-muted: #c8c2e6;
  --panel-border: rgba(255,255,255,.14);
  --panel-bgsoft: rgba(255,255,255,.04);

  font-size: 1.125rem;
  color: var(--panel-text);
}

.loc-panel .btn-close { filter: invert(1) brightness(1.3); opacity: .9; }
.loc-panel .offcanvas-header { border-bottom: 1px solid var(--panel-border); }
.loc-panel .offcanvas-title { color: var(--panel-text); font-size: 1.35rem; font-weight: 700; letter-spacing: .3px; }
.loc-panel .offcanvas-body  { color: var(--panel-text); line-height: 1.6; }
/* allow expanded mini-cards to overflow the scroll box */
.loc-panel .offcanvas-body { overflow: visible; }

.loc-panel .loc-desc        { color: var(--panel-muted); }

.loc-panel .loc-sec {
  background: var(--panel-bgsoft);
  border: 1px solid var(--panel-border);
  border-radius: 12px;
  padding: .85rem;
  margin-bottom: 1rem;
}
.loc-panel .loc-sec-title {
  display:flex; align-items:center; justify-content:space-between;
  font-weight:700; letter-spacing:.2px; margin-bottom:.5rem;
  color: var(--panel-text);
}
.loc-panel .badge-soft {
  background: rgba(126, 88, 255, .2);
  border: 1px solid rgba(126, 88, 255, .35);
  color: #e9e4ff;
  padding: .15rem .5rem;
  border-radius: .4rem;
}
.loc-panel .loc-item + .loc-item { margin-top: .6rem; }
.loc-panel .text-muted { color: var(--panel-muted) !important; }

/* ===== Removed old scaler =====
   .card-compact { ... }
   .card-compact > * { width: 133.333%; }
   These caused the “sliver” stretching. */
