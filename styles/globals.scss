/* ==========================================================================
   DnDNext – Global styles
   --------------------------------------------------------------------------
   WHAT'S IN HERE
   • CSS variables + color tokens
   • Bootstrap layer fixes (z-index for modals/offcanvas/tooltips)
   • Map layout (shell, wrap, image, overlay)
   • Pins (generic, location, merchant pill)
   • Dim overlay when a side panel is open
   • Offcanvas panels (Location + Merchant)
   • Utility helpers + small responsive tweaks
   ========================================================================== */


/* ========== 1) CSS VARIABLES / THEME TOKENS =============================== */

:root{
  /* brand */
  --ink: #121019;
  --ink-2: #1c1a24;
  --ink-3: #231f2f;

  --ui: #262335;
  --ui-2: #312c48;
  --ui-3: #3b3560;

  --accent: #7e58ff;
  --accent-2: #bfa3ff;

  /* parchment */
  --paper: #f6f1e5;
  --paper-ink: #3a2f22;

  /* map border accents */
  --frame: #b7aa8a;
  --frame-dark: #6e6755;

  /* pills (merchant types) */
  --pill-general: #6b7280;   /* slate */
  --pill-smith:   #a16207;   /* amber */
  --pill-weapons: #dc2626;   /* red */
  --pill-alchemy: #059669;   /* emerald */
  --pill-herbal:  #16a34a;   /* green */
  --pill-caravan: #ca8a04;   /* yellow */
  --pill-stable:  #7c3aed;   /* violet */
  --pill-cloth:   #0ea5e9;   /* sky */
  --pill-jewel:   #0891b2;   /* cyan */
  --pill-arcane:  #8b5cf6;   /* indigo */

  /* z-index steps (Bootstrap reserves: modal 1050…1100-ish) */
  --z-map:            10;
  --z-pins:           20;
  --z-dim:            30;
  --z-offcanvas:    1045;
  --z-tooltips:     1080;
  --z-modal:        1100;

  /* card-compact (mini ItemCard) expects these in card-compact.css,
     but duplicating here keeps the mental model handy */
  --card-w: 360px;
  --card-h: 520px;
}


/* ========== 2) BOOTSTRAP LAYER FIXES  ===================================== */
/* Make sure Bootstrap chrome always stacks above the map,
   and that tooltips/popovers aren’t buried. */

.modal,
.modal-backdrop { z-index: var(--z-modal) !important; }

.tooltip,
.popover { z-index: var(--z-tooltips) !important; }

/* Offcanvas specifically for our right-side panels. */
.offcanvas,
.offcanvas-backdrop { z-index: var(--z-offcanvas) !important; }

/* Reduce backdrop darkness a bit for the parchment look. */
.offcanvas-backdrop.show { background-color: rgba(10, 8, 14, .5); }


/* ========== 3) PAGE CHROME (navbar, base text) ============================ */

body{
  background: linear-gradient(180deg, var(--ink-2), var(--ink-3));
  color: #e9e7ef;
}

.navbar, .navbar-dark{
  background-color: var(--ink-2) !important;
  border-bottom: 1px solid rgba(255,255,255,.06);
}


/* ========== 4) MAP LAYOUT =================================================
   Structure in /pages/map.js:
   .map-page
     .map-shell
       .map-dim            <- only when a panel is open
       .map-wrap
         <img.map-img />
         .map-overlay      <- pin containers (absolutely positioned box)
   ========================================================================== */

.map-page{
  position: relative;
}

/* Outer frame keeps the map from running full bleed on huge screens */
.map-shell{
  position: relative;
  max-width: 1100px;
  margin: 0 auto;
  border: 6px solid var(--frame);
  border-radius: 10px;
  box-shadow: 0 10px 30px rgba(0,0,0,.35);
  background: #0f0e14;
}

/* Click-catcher + grid reference for overlay anchors */
.map-wrap{
  position: relative;
  width: 100%;
  /* Preserve aspect ratio of your map image.
     This value should match your asset (Wmap.jpg). */
  aspect-ratio: 3 / 4;  /* <— adjust if your image changes */
  overflow: hidden;
}

/* The map image fills the wrapper and becomes the positioning reference. */
.map-img{
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;   /* keeps drawn positions accurate against percentage */
  user-select: none;
  pointer-events: none; /* pins handle interactions */
  z-index: var(--z-map);
}

/* Where pins live. 100% width/height so left/top in % are reliable. */
.map-overlay{
  position: absolute;
  inset: 0;
  z-index: var(--z-pins);
  pointer-events: none; /* we re-enable per-pin so the empty space doesn’t eat clicks */
}

/* Subtle darkening of the map while a side panel is open. */
.map-dim{
  position: absolute;
  inset: 0;
  background: rgba(10,8,14,.0);
  transition: background .18s ease;
  pointer-events: none;
  z-index: var(--z-dim);
}
.map-dim.show{ background: rgba(10,8,14,.35); }


/* ========== 5) PINS ========================================================
   Shared pin base + specific variants for locations and merchants.
   - We keep pointer-events ON for buttons/links themselves,
     but OFF on the overlay container (see above).
   ========================================================================== */

.map-pin{
  position: absolute;
  transform: translate(-50%, -50%); /* left/top centers the pin */
  pointer-events: auto;
  border: 0;
  background: transparent;
  padding: 0;
  margin: 0;
  font: inherit;
}

/* ----- Location: round gem pin ------------------------------------------ */
.pin-location{
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, #a78bfa, #4c1d95 70%);
  box-shadow: 0 0 0 2px rgba(255,255,255,.85), 0 4px 10px rgba(0,0,0,.45);
  outline-offset: 2px;
}
.pin-location:hover{ box-shadow: 0 0 0 3px #fff, 0 8px 18px rgba(0,0,0,.55); }

/* ----- Merchant: icon pill w/ name label on hover ----------------------- */
.pin-merchant{
  --pill-bg: var(--pill-general);
  --pill-ink: #fff;

  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  border-radius: 999px;
  color: var(--pill-ink);
  background: linear-gradient(180deg, color-mix(in lab, var(--pill-bg), #000 8%), var(--pill-bg));
  box-shadow: 0 1px 0 rgba(255,255,255,.15) inset, 0 4px 10px rgba(0,0,0,.4);
  white-space: nowrap;
  max-width: 220px;
}

/* Icon-only look by default; reveal label on focus/hover (keyboard friendly). */
.pin-merchant .pin-label{ 
  display: none; 
}
.pin-merchant:focus .pin-label,
.pin-merchant:hover .pin-label{
  display: inline;
}

/* “Themes” wired in utilities/merchantTheme.js (className pill-<theme>) */
.pill-smith   { --pill-bg: var(--pill-smith); }
.pill-weapons { --pill-bg: var(--pill-weapons); }
.pill-alchemy { --pill-bg: var(--pill-alchemy); }
.pill-herbal  { --pill-bg: var(--pill-herbal); }
.pill-caravan { --pill-bg: var(--pill-caravan); }
.pill-stable  { --pill-bg: var(--pill-stable); }
.pill-cloth   { --pill-bg: var(--pill-cloth); }
.pill-jeweler { --pill-bg: var(--pill-jewel); }
.pill-arcanist{ --pill-bg: var(--pill-arcane); }

/* Extra-small “chip” look used in some lists (if you render <Pill small />). */
.pill{
  display: inline-flex;
  align-items: center;
  gap: .45rem;
  border-radius: 999px;
  padding: .35rem .6rem;
  font-weight: 600;
  line-height: 1;
  color: #fff;
}
.pill-sm{
  font-size: 12px;
  padding: .2rem .45rem;
}
.pill-ico{ filter: drop-shadow(0 1px 0 rgba(0,0,0,.25)); }

/* Accessibility: visible keyboard outline for any pin */
.map-pin:focus{
  outline: 3px solid var(--accent-2);
  outline-offset: 2px;
}


/* ========== 6) OFFCANVAS PANELS (Right side) ==============================
   IDs used by the app:
   - #locPanel      (Location details)
   - #merchantPanel (Merchant shop)
   We apply the same chrome to both.
   ========================================================================== */

.offcanvas-end.loc-panel,
.offcanvas-end.merchant-panel,
#locPanel.offcanvas-end,
#merchantPanel.offcanvas-end{
  width: min(520px, 92vw);
  border-left: 2px solid rgba(255,255,255,.06);
  background: var(--paper) url("/parchment.jpg") center/cover fixed;
  color: var(--paper-ink);
}

.offcanvas-end .offcanvas-header{
  background: rgba(255,255,255,.5);
  border-bottom: 1px solid rgba(0,0,0,.08);
}
.offcanvas-end .offcanvas-title{
  font-weight: 700;
}

/* Body area scrolls independently of the map */
.offcanvas-end .offcanvas-body{
  max-height: calc(100vh - 64px);
  overflow-y: auto;
  scrollbar-gutter: stable both-edges;
}

/* When ItemCards expand (from card-compact.css), make sure they win stacking */
.offcanvas-end .merchant-grid .tile:hover .sitem-card,
.offcanvas-end .merchant-grid .tile:focus-within .sitem-card{
  z-index: calc(var(--z-offcanvas) + 20);
}


/* ========== 7) LOCATION PANEL INTERNAL BITS =============================== */

.loc-desc{
  white-space: pre-wrap;
  line-height: 1.35;
}

.loc-sec{ margin-top: 1rem; }
.loc-sec-title{
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-bottom: .35rem;
  margin-bottom: .35rem;
  border-bottom: 1px dashed rgba(0,0,0,.15);
}
.loc-item + .loc-item{ margin-top: .75rem; }
.badge-soft{
  background: rgba(0,0,0,.08);
  border: 1px solid rgba(0,0,0,.08);
}


/* ========== 8) UTILITIES ================================================== */

.badge.text-bg-secondary{ background-color: #4b5563 !important; }
.badge.rounded-pill.text-bg-dark{ background-color: #111827 !important; }

/* Reduce focus-ring harshness on dark UI */
.btn:focus,
.form-control:focus{
  box-shadow: 0 0 0 .2rem rgba(126, 88, 255, .35);
  border-color: var(--accent-2);
}

/* Small helper to keep the admin pills tidy if you render many */
.pill-cloud{
  display: flex; flex-wrap: wrap; gap: .5rem;
}


/* ========== 9) RESPONSIVE NIPS ============================================ */

@media (max-width: 768px){
  .map-shell{ border-width: 4px; }
  .pin-merchant{ padding: 5px 8px; font-size: 13px; }
  .pin-location{ width: 16px; height: 16px; }
}

@media (max-width: 576px){
  .map-shell{ box-shadow: 0 6px 18px rgba(0,0,0,.3); }
}


/* ==========================================================================
   NOTES FOR FUTURE YOU
   --------------------------------------------------------------------------
   • If pin coordinates ever look horizontally shifted again, double-check that
     .map-img uses object-fit: cover and the wrapper’s aspect-ratio matches the
     underlying JPG. Any mismatch can skew left/top percentages visually.

   • Offcanvas z-index is set to 1045 (above the map, below modals). Expanded
     ItemCards in the merchant grid raise their z-index a bit more to ensure
     they float over the panel chrome and the map.

   • .map-dim is toggled from React by adding/removing the "show" class when
     either #locPanel or #merchantPanel becomes visible.

   • Merchant theme classes (pill-smith, pill-alchemy, …) are kept simple.
     If you add more, define a new --pill-bg var here.

   • The mini-card geometry (var(--card-w/--card-h)) is documented here but the
     actual compact behavior lives in styles/card-compact.css.
   ========================================================================== */
