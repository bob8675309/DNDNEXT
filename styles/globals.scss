/* ========================================================================
   GLOBALS.SCSS — DnDNext  (fixed)
   ------------------------------------------------------------------------
   Goals:
   1) Velvet theme colors (purple/blue tones) applied app‑wide.
   2) Map never cropped; pins render above map; hover labels visible.
   3) Offcanvas panels & modals open above backdrops and above map.
   4) Merchant grid/cards sit above the map when open.
   5) A dim overlay appears over the map while a side panel is open.
   6) Compatible with existing /styles/card-compact.css.

   IMPORTANT: A stray JSX block had been pasted into this file previously
   (createPortal/offcanvas markup). That was invalid SCSS and caused the
   Vercel build error ("expected '}'"). The JSX has been removed and the
   variables are wrapped inside :root { }.
   ======================================================================= */

/* ========================================================================
   0) CSS VARIABLES / THEME TOKENS
   ======================================================================= */
:root {
  /* Velvet palette */
  --ink: #e9e7ff;               /* main text on dark */
  --ink-dim: #c9c6ff;           /* secondary text on dark */
  --bg-900: #0f0b1e;            /* page background (near black violet) */
  --bg-800: #151129;            /* panel background */
  --bg-700: #1b1733;            /* header / cards */
  --bg-600: #241e44;            /* subtle stripes / hover */
  --accent: #8c7cff;            /* primary accent */
  --accent-2: #6bd5ff;          /* secondary accent (teal/blue) */
  --warning: #ffb870;
  --danger: #ff6b6b;

  /* Borders / shadows */
  --line: rgba(255,255,255,.08);
  --soft-shadow: 0 6px 30px rgba(0,0,0,.35), 0 0 1px rgba(255,255,255,.035);

  /* Z-index tokens (higher than Bootstrap defaults) */
  --z-map: 1000;                /* base map image */
  --z-pins: 1200;               /* location/merchant pins */
  --z-tooltips: 1400;           /* pin labels */
  --z-dim: 1500;                /* dim overlay when panels open */
  --z-offcanvas: 2000;          /* offcanvas panels */
  --z-modal: 2100;              /* modals above offcanvas */
  --z-popover: 2200;            /* misc floating bits in admin */
}

/* ========================================================================
   1) BASE / TYPOGRAPHY
   ======================================================================= */
html, body { height: 100%; }
body {
  background: radial-gradient(1200px 800px at 20% -10%, #1d1838 0%, var(--bg-900) 50%) fixed,
              radial-gradient(1000px 700px at 120% 10%, #1a2d4a 0%, transparent 50%) fixed,
              var(--bg-900);
  color: var(--ink);
  font-feature-settings: "liga" 1, "kern" 1;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

a { color: var(--accent-2); }
a:hover { color: #9ee6ff; }

.navbar, .navbar-dark, .navbar .nav-link { color: var(--ink); }

/* Utility pills / badges */
.badge-soft {
  background: rgba(255,255,255,.06);
  border: 1px solid var(--line);
  color: var(--ink-dim);
}

/* Cards */
.card {
  background: var(--bg-700);
  border: 1px solid var(--line);
  box-shadow: var(--soft-shadow);
  color: var(--ink);
}
.card .card-header {
  background: linear-gradient(180deg, var(--bg-700) 0%, var(--bg-800) 100%);
  border-bottom: 1px solid var(--line);
}
.card .card-footer {
  background: linear-gradient(180deg, var(--bg-800) 0%, var(--bg-700) 100%);
  border-top: 1px solid var(--line);
}

/* Forms / buttons */
.form-control, .form-select { background: var(--bg-800); border: 1px solid var(--line); color: var(--ink); }
.form-control:focus, .form-select:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 .2rem rgba(140,124,255,.25);
}
.btn-primary {
  background: linear-gradient(180deg, var(--accent) 0%, #6f5fff 100%);
  border-color: #6f5fff; color: #fff;
}
.btn-outline-primary { border-color: var(--accent); color: var(--accent); }
.btn-outline-primary:hover { background: var(--accent); color: #fff; }

/* ========================================================================
   2) LAYOUT GUARDS (avoid unintended cropping)
   ======================================================================= */
.map-page { min-height: 100%; }
.map-page .container-fluid { overflow: visible; }

/* ========================================================================
   3) MAP LAYOUT + PINS + HOVER LABELS
   ======================================================================= */
/* Outer shell gives us the frame and central column */
.map-shell { max-width: 1200px; margin: 0 auto; padding-bottom: 2rem; position: relative; }

/* Wrap that holds the image and overlayed pins */
.map-wrap { position: relative; overflow: visible; z-index: var(--z-map); }

/* The map image */
.map-img {
  display: block; width: 100%; height: auto; user-select: none; pointer-events: auto;
  border: 8px solid #bdae91; box-shadow: 0 10px 40px rgba(0,0,0,.45);
}

/* Pins/labels layer that sits ABOVE the map image */
.map-overlay { position: absolute; inset: 0; z-index: var(--z-pins); pointer-events: none; }

/* Base pin style */
.map-pin {
  position: absolute; transform: translate(-50%, -100%);
  pointer-events: auto; z-index: var(--z-pins);
  width: 20px; height: 20px; background: #5f7cff;
  border: 2px solid #dfe6ff; border-radius: 4px; box-shadow: 0 4px 18px rgba(0,0,0,.45);
}

/* Location pin (square) */
.pin-location { background: #9d83ff; border-color: #eaddff; }

/* Merchant pill pins */
.pin-merchant.pin-pill {
  display: inline-flex; align-items: center; gap: .4rem; height: 28px; padding: 0 .6rem;
  border-radius: 999px; border: 1px solid rgba(255,255,255,.2);
  background: linear-gradient(180deg, rgba(255,255,255,.07) 0%, rgba(255,255,255,.03) 100%);
}
.pin-merchant .pill-ico { font-size: 14px; line-height: 1; opacity: .95; }
.pin-merchant .pin-label {
  position: absolute; left: 50%; top: -34px; transform: translateX(-50%);
  white-space: nowrap; padding: .2rem .5rem; border-radius: .5rem; font-size: 12px;
  color: var(--ink); background: rgba(0,0,0,.55); border: 1px solid var(--line);
  box-shadow: 0 6px 18px rgba(0,0,0,.45); z-index: var(--z-tooltips);
  opacity: 0; pointer-events: none; transition: opacity .12s ease-out, transform .12s ease-out;
}
.pin-merchant:focus .pin-label, .pin-merchant:hover .pin-label { opacity: 1; transform: translate(-50%, -2px); }

/* The semi-opaque dim over the map while a panel is open */
.map-dim {
  position: absolute; inset: 0;
  background: radial-gradient(800px 500px at 40% 20%, rgba(20,16,40,.55) 0%, rgba(9,7,20,.65) 60%, rgba(6,5,15,.75) 100%);
  z-index: var(--z-dim); opacity: 0; pointer-events: none; transition: opacity .18s ease-out;
}
.map-dim.show { opacity: 1; pointer-events: auto; }

/* ========================================================================
   4) OFFCANVAS / MODALS / BOOTSTRAP STACKING FIXES
   ======================================================================= */
.offcanvas, .offcanvas.show, .offcanvas-backdrop, .modal, .modal.show, .modal-backdrop, .popover, .tooltip { z-index: var(--z-offcanvas); }
.modal, .modal.show { z-index: var(--z-modal); }
.modal-backdrop.show { z-index: calc(var(--z-modal) - 1); }

.offcanvas-backdrop.show { background-color: rgba(12,9,25,.78); }
.offcanvas {
  background: var(--bg-800); color: var(--ink); border-left: 1px solid var(--line); box-shadow: var(--soft-shadow);
}
.offcanvas .offcanvas-header { background: linear-gradient(180deg, var(--bg-700) 0%, var(--bg-800) 100%); border-bottom: 1px solid var(--line); }
.offcanvas .offcanvas-title { color: var(--ink); }

/* Readable desktop width while keeping mobile-friendly */
.loc-panel, .merchant-panel { width: min(420px, 100vw); }

/* ========================================================================
   5) MERCHANT GRID / MINI CARDS
   ======================================================================= */
.merchant-grid {
  position: relative; z-index: var(--z-popover);
  display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: .75rem; margin-top: .5rem;
}
.merchant-grid .tile {
  position: relative; background: linear-gradient(180deg, var(--bg-700), var(--bg-800));
  border: 1px solid var(--line); border-radius: .75rem; overflow: hidden; box-shadow: var(--soft-shadow);
}
.merchant-grid .buy-strip {
  position: sticky; bottom: 0; display: flex; align-items: center; gap: .4rem; padding: .4rem .5rem;
  background: linear-gradient(180deg, rgba(0,0,0,.2), rgba(0,0,0,.35)); border-top: 1px solid var(--line); z-index: var(--z-popover);
}

/* Compact ItemCard helpers (coexist with card-compact.css) */
.sitem-card, .card-compact { background: var(--bg-700) !important; color: var(--ink) !important; border: 1px solid var(--line) !important; }
.sitem-header { display: flex; align-items: center; justify-content: space-between; }
.sitem-title { font-weight: 600; }

/* ========================================================================
   6) ADMIN PAGE POLISH
   ======================================================================= */
.admin-toolbar .badge, .admin-toolbar .btn { border-radius: .6rem; }
.admin-preview {
  background: linear-gradient(180deg, var(--bg-800) 0%, var(--bg-700) 100%);
  border: 1px solid var(--line); border-radius: 1rem; box-shadow: var(--soft-shadow); overflow: hidden;
}
.admin-preview .preview-head { padding: .6rem .9rem; border-bottom: 1px solid var(--line); background: linear-gradient(180deg, var(--bg-700) 0%, var(--bg-800) 100%); }
.admin-preview .preview-body { padding: 1rem 1.2rem; }

/* ========================================================================
   7) MISC FIXES / QUALITY OF LIFE
   ======================================================================= */
.map-page .btn-group, .map-page .btn { border-radius: .6rem; }
.map-page .input-group-text { background: var(--bg-700); color: var(--ink-dim); border: 1px solid var(--line); }

.tooltip-inner { background-color: rgba(10,8,22,.95); color: var(--ink); border: 1px solid var(--line); }

.dropdown-menu { background: var(--bg-800); color: var(--ink); border: 1px solid var(--line); box-shadow: var(--soft-shadow); }

.table { color: var(--ink); }
.table thead th { color: var(--ink); border-bottom: 1px solid var(--line); }
.table td, .table th { border-color: var(--line); }

.alert { background: rgba(255,255,255,.06); border: 1px solid var(--line); color: var(--ink); }
.alert-danger { background: rgba(255,107,107,.08); border-color: rgba(255,107,107,.4); }

/* ========================================================================
   8) RARITY TRIMS FOR ITEM CARDS (subtle gold/teal/violet bands)
   ======================================================================= */
.sitem-card { position: relative; overflow: hidden; }
.sitem-card .card-header { background: linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,0)); }
.sitem-card[data-rarity="common"]    { box-shadow: 0 0 0 1px rgba(180,180,190,.25) inset; }
.sitem-card[data-rarity="uncommon"]  { box-shadow: 0 0 0 1px rgba(90,200,170,.35) inset; }
.sitem-card[data-rarity="rare"]      { box-shadow: 0 0 0 1px rgba(80,160,255,.38) inset, 0 0 0 2px rgba(80,160,255,.10); }
.sitem-card[data-rarity="very rare"] { box-shadow: 0 0 0 1px rgba(190,120,255,.45) inset, 0 0 0 2px rgba(190,120,255,.12); }
.sitem-card[data-rarity="legendary"] { box-shadow: 0 0 0 1px rgba(255,208,112,.55) inset, 0 0 0 2px rgba(255,208,112,.18); }
.sitem-card[data-rarity="artifact"]  { box-shadow: 0 0 0 1px rgba(255,237,168,.75) inset, 0 0 0 2px rgba(255,237,168,.22); }
.sitem-card::before {
  content: ""; position: absolute; left: 0; right: 0; top: 0; height: 3px;
  background: linear-gradient(90deg, rgba(255,215,128,.35), rgba(255,215,128,0) 60%);
  pointer-events: none;
}
.sitem-card .sitem-section .small.text-muted { color: var(--ink-dim) !important; }

/* ========================================================================
   9) THEMED MERCHANT PILLS (tiny color hints)
   ======================================================================= */
.pill-sm { height: 26px; padding: 0 .6rem; }
.pill-sm .pill-ico { font-size: 14px; }
.pill-sm .pill-txt { font-size: 12px; }
.pill-sm, .pin-pill { color: #fff; text-shadow: 0 1px 0 rgba(0,0,0,.25); }
.pill-sm.pill-smith,    .pin-pill.pill-smith    { background: linear-gradient(180deg,#d17d41,#a85f2f); }
.pill-sm.pill-weapons,  .pin-pill.pill-weapons  { background: linear-gradient(180deg,#e05e67,#b2484e); }
.pill-sm.pill-alchemy,  .pin-pill.pill-alchemy  { background: linear-gradient(180deg,#3ba59c,#2b7d77); }
.pill-sm.pill-herbalist,.pin-pill.pill-herbalist{ background: linear-gradient(180deg,#5cb85c,#3b8f3b); }
.pill-sm.pill-caravan,  .pin-pill.pill-caravan  { background: linear-gradient(180deg,#c6a35f,#9e7e43); }
.pill-sm.pill-stable,   .pin-pill.pill-stable   { background: linear-gradient(180deg,#c9803c,#a1652e); }
.pill-sm.pill-clothier, .pin-pill.pill-clothier { background: linear-gradient(180deg,#7d6bca,#5f51a0); }
.pill-sm.pill-jeweler,  .pin-pill.pill-jeweler  { background: linear-gradient(180deg,#d2a900,#a58500); }
.pill-sm.pill-arcanist, .pin-pill.pill-arcanist { background: linear-gradient(180deg,#6f86ff,#586adf); }
.pill-sm.pill-general,  .pin-pill.pill-general  { background: linear-gradient(180deg,#7c8ba3,#5a6b82); }

/* ========================================================================
   10) RESPONSIVE TUNING
   ======================================================================= */
@media (max-width: 992px) {
  .map-shell { padding-inline: .5rem; }
  .loc-panel, .merchant-panel { width: min(100vw, 420px); }
  .merchant-grid { grid-template-columns: 1fr 1fr; }
}
@media (max-width: 576px) {
  .merchant-grid { grid-template-columns: 1fr; }
  .pin-merchant .pin-label { display: none; } /* mobile hover-less */
}
